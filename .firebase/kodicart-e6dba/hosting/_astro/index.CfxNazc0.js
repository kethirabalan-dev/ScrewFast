const c=console.debug,h=new Set,s=new WeakSet;let u,p,d=!1;function T(e){d||(d=!0,c?.("[astro] Initializing prefetch script"),u??=e?.prefetchAll??!1,p??=e?.defaultStrategy??"hover",m(),v(),w(),S())}function m(){for(const e of["touchstart","mousedown"])document.body.addEventListener(e,t=>{i(t.target,"tap")&&f(t.target.href,{ignoreSlowConnection:!0})},{passive:!0})}function v(){let e;document.body.addEventListener("focusin",n=>{i(n.target,"hover")&&t(n)},{passive:!0}),document.body.addEventListener("focusout",r,{passive:!0}),l(()=>{for(const n of document.getElementsByTagName("a"))s.has(n)||i(n,"hover")&&(s.add(n),n.addEventListener("mouseenter",t,{passive:!0}),n.addEventListener("mouseleave",r,{passive:!0}))});function t(n){const o=n.target.href;e&&clearTimeout(e),e=setTimeout(()=>{f(o)},80)}function r(){e&&(clearTimeout(e),e=0)}}function w(){let e;l(()=>{for(const t of document.getElementsByTagName("a"))s.has(t)||i(t,"viewport")&&(s.add(t),e??=y(),e.observe(t))})}function y(){const e=new WeakMap;return new IntersectionObserver((t,r)=>{for(const n of t){const o=n.target,a=e.get(o);n.isIntersecting?(a&&clearTimeout(a),e.set(o,setTimeout(()=>{r.unobserve(o),e.delete(o),f(o.href)},300))):a&&(clearTimeout(a),e.delete(o))}})}function S(){l(()=>{for(const e of document.getElementsByTagName("a"))i(e,"load")&&f(e.href)})}function f(e,t){e=e.replace(/#.*/,"");const r=t?.ignoreSlowConnection??!1;if(E(e,r))if(h.add(e),HTMLScriptElement.supports?.("speculationrules"))c?.(`[astro] Prefetching ${e} with <script type="speculationrules">`),L(e);else if(document.createElement("link").relList?.supports?.("prefetch")&&t?.with!=="fetch"){c?.(`[astro] Prefetching ${e} with <link rel="prefetch">`);const n=document.createElement("link");n.rel="prefetch",n.setAttribute("href",e),document.head.append(n)}else c?.(`[astro] Prefetching ${e} with fetch`),fetch(e,{priority:"low"})}function E(e,t){if(!navigator.onLine||!t&&g())return!1;try{const r=new URL(e,location.href);return location.origin===r.origin&&(location.pathname!==r.pathname||location.search!==r.search)&&!h.has(e)}catch{}return!1}function i(e,t){if(e?.tagName!=="A")return!1;const r=e.dataset.astroPrefetch;return r==="false"?!1:t==="tap"&&(r!=null||u)&&g()?!0:r==null&&u||r===""?t===p:r===t}function g(){if("connection"in navigator){const e=navigator.connection;return e.saveData||/2g/.test(e.effectiveType)}return!1}function l(e){e();let t=!1;document.addEventListener("astro:page-load",()=>{if(!t){t=!0;return}e()})}function L(e){const t=document.createElement("script");t.type="speculationrules",t.textContent=JSON.stringify({prerender:[{source:"list",urls:[e]}],prefetch:[{source:"list",urls:[e]}]}),document.head.append(t)}export{T as i};
